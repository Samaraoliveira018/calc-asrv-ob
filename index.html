<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calculadora de Banca com Soros</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background: #f8f9fa;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 1100px;
      margin: 20px auto;
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    table th, table td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: center;
    }
    table th {
      background: #2c3e50;
      color: white;
    }
    button {
      cursor: pointer;
    }
  </style>
</head>
<body>

  <!-- Indicador da Banca Atual -->
  <h3 id="indicadorBancaAtual" style="
    text-align:center;
    color:#27ae60;
    margin-top:25px;
    font-size:1.6em;
    font-weight:600;
  ">
  💰 Banca Atual: R$ 0,00
  </h3>

  <div class="container">
    <h2 style="text-align:center;">📊 Calculadora de Gerenciamento Binário</h2>

    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:10px;margin-top:20px;">
      <label>Banca Inicial:<br><input id="bancaInicial" type="number" value="400"></label>
      <label>% Investido:<br><input id="investimentoPercentual" type="number" value="10"></label>
      <label>Payout %:<br><input id="payoutPercentual" type="number" value="88"></label>
      <label>Ops/Dia:<br><input id="operacoesPorDia" type="number" value="2"></label>
      <label>Dias:<br><input id="diasPlanejamento" type="number" value="30"></label>
    </div>

    <div style="margin-top:15px;">
      <label><input type="radio" name="tipoGerenciamento" value="fixo" checked> Fixo</label>
      <label><input type="radio" name="tipoGerenciamento" value="soros"> Soros</label>
    </div>

    <div style="display:flex;justify-content:space-around;margin-top:20px;">
      <div><strong>Banca Final:</strong> <span id="previewBancaFinal">R$ 0,00</span></div>
      <div><strong>Lucro Total:</strong> <span id="previewLucroTotal">R$ 0,00</span></div>
      <div><strong>Crescimento:</strong> <span id="previewCrescimento">0%</span></div>
      <div><strong>Entrada/Op:</strong> <span id="previewEntradaPorOp">R$ 0,00</span></div>
      <div><strong>Lucro/Op:</strong> <span id="previewLucroPorOp">R$ 0,00</span></div>
    </div>

    <table id="previewTable">
      <thead>
        <tr>
          <th>Dia</th>
          <th>Banca Inicial</th>
          <th>% Investido</th>
          <th>Entradas</th>
          <th>Lucros</th>
          <th>Lucro Diário</th>
          <th>Nova Banca</th>
          <th>Gerenciamento</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- === SCRIPT FINAL FUNCIONAL === -->
  <script>
  document.addEventListener("DOMContentLoaded", () => {

  let dadosCalculados=[];

  function salvarDados(){
    const cfg={
      bancaInicial:+document.getElementById("bancaInicial").value||400,
      investimentoPercentual:+document.getElementById("investimentoPercentual").value||10,
      payoutPercentual:+document.getElementById("payoutPercentual").value||88,
      operacoesPorDia:+document.getElementById("operacoesPorDia").value||2,
      diasPlanejamento:+document.getElementById("diasPlanejamento").value||30,
      tipoGerenciamento:document.querySelector('input[name="tipoGerenciamento"]:checked')?.value||"fixo"
    };
    localStorage.setItem("configBinarias",JSON.stringify(cfg));
  }

  function carregarDados(){
    const s=localStorage.getItem("configBinarias");
    if(!s)return;
    const c=JSON.parse(s);
    ["bancaInicial","investimentoPercentual","payoutPercentual","operacoesPorDia","diasPlanejamento"]
    .forEach(id=>{
      const el=document.getElementById(id);
      if(el && c[id]!==undefined) el.value=c[id];
    });
    if(c.tipoGerenciamento){
      const radio=document.querySelector(`input[name="tipoGerenciamento"][value="${c.tipoGerenciamento}"]`);
      if(radio) radio.checked=true;
    }
  }

  function formatar(v){return v.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2});}

  function calcularDados(){
    const bancaInicial=+document.getElementById("bancaInicial").value||400;
    const perc=+document.getElementById("investimentoPercentual").value||10;
    const payout=+document.getElementById("payoutPercentual").value||88;
    const ops=+document.getElementById("operacoesPorDia").value||2;
    const dias=+document.getElementById("diasPlanejamento").value||30;
    const tipo=document.querySelector('input[name="tipoGerenciamento"]:checked')?.value||"fixo";

    dadosCalculados=[];
    let banca=bancaInicial;

    for(let d=1;d<=dias;d++){
      let totalInvestidoDia,entradaPorOperacao,lucroPorOperacao,lucroTotalDia,novaBanca;
      if(tipo==="fixo"){
        totalInvestidoDia=banca*(perc/100);
        const entrada=totalInvestidoDia/ops;
        const lucroOp=entrada*(payout/100);
        lucroTotalDia=lucroOp*ops;
        entradaPorOperacao=Array(ops).fill(entrada);
        lucroPorOperacao=Array(ops).fill(lucroOp);
        novaBanca=banca+lucroTotalDia;
      }else{
        const entradaBase=banca*(perc/100);
        const entradas=[],lucros=[];
        for(let i=0;i<ops;i++){
          const entradaAtual=(i===0)?entradaBase:(entradaBase+lucros[i-1]);
          const lucroAtual=entradaAtual*(payout/100);
          entradas.push(entradaAtual);
          lucros.push(lucroAtual);
        }
        entradaPorOperacao=entradas;
        lucroPorOperacao=lucros;
        totalInvestidoDia=entradas.reduce((s,v)=>s+v,0);
        lucroTotalDia=lucros.reduce((s,v)=>s+v,0);
        novaBanca=banca+lucroTotalDia;
      }

      dadosCalculados.push({
        dia:d,bancaInicial:banca,investimentoPercentual:perc,totalInvestidoDia,
        operacoesPorDia:ops,entradaPorOperacao,lucroPorOperacao,lucroTotalDia,
        novaBanca,tipoGerenciamento:tipo,resultado:"none"
      });
      banca=novaBanca;
    }
    atualizarPreview();
    salvarDados();
  }

  function aplicarResultado(diaIndex,resultado){
    const d=dadosCalculados[diaIndex];
    if(resultado==="loss1"){ 
      const perda=d.entradaPorOperacao[0];
      d.lucroTotalDia=-perda;
      d.novaBanca=d.bancaInicial-perda;
      d.resultado="Loss 1ª";
    } 
    else if(resultado==="loss2"){
      const perda=d.entradaPorOperacao[1];
      d.lucroTotalDia-=perda;
      d.novaBanca=d.bancaInicial+d.lucroTotalDia;
      d.resultado="Loss 2ª";
    } else d.resultado="Win";
    for(let i=diaIndex+1;i<dadosCalculados.length;i++){
      const prev=dadosCalculados[i-1];
      dadosCalculados[i].bancaInicial=prev.novaBanca;
      const perc=dadosCalculados[i].investimentoPercentual;
      const payout=+document.getElementById("payoutPercentual").value/100;
      if(dadosCalculados[i].tipoGerenciamento==="soros"){
        const base=prev.novaBanca*(perc/100);
        const entradas=[],lucros=[];
        for(let j=0;j<dadosCalculados[i].operacoesPorDia;j++){
          const e=(j===0)?base:(base+lucros[j-1]);
          const l=e*payout;
          entradas.push(e);lucros.push(l);
        }
        dadosCalculados[i].entradaPorOperacao=entradas;
        dadosCalculados[i].lucroPorOperacao=lucros;
        dadosCalculados[i].lucroTotalDia=lucros.reduce((s,v)=>s+v,0);
        dadosCalculados[i].novaBanca=prev.novaBanca+dadosCalculados[i].lucroTotalDia;
      }else{
        const total=prev.novaBanca*(perc/100);
        const entrada=total/dadosCalculados[i].operacoesPorDia;
        const lucro=entrada*payout;
        dadosCalculados[i].entradaPorOperacao=Array(dadosCalculados[i].operacoesPorDia).fill(entrada);
        dadosCalculados[i].lucroPorOperacao=Array(dadosCalculados[i].operacoesPorDia).fill(lucro);
        dadosCalculados[i].lucroTotalDia=lucro*dadosCalculados[i].operacoesPorDia;
        dadosCalculados[i].novaBanca=prev.novaBanca+dadosCalculados[i].lucroTotalDia;
      }
      dadosCalculados[i].resultado="none";
    }
    atualizarPreview();
  }

  function resetarSimulacao(limparConfig=false){
    dadosCalculados.forEach(d=>d.resultado="none");
    if(limparConfig) localStorage.removeItem("configBinarias");
    calcularDados();
  }

  function atualizarPreview(){
    if(!dadosCalculados.length)return;
    const bi=dadosCalculados[0].bancaInicial;
    const bf=dadosCalculados.at(-1).novaBanca;
    const lucroTotal=bf-bi;
    const crescimento=((bf-bi)/bi)*100;
    const lucroMedioDia=lucroTotal/dadosCalculados.length;

    const indicador=document.getElementById("indicadorBancaAtual");
    if(indicador){
      indicador.textContent=`💰 Banca Atual: R$ ${formatar(bf)}`;
      indicador.style.color = (bf > bi) ? "#27ae60" : (bf < bi) ? "#e74c3c" : "#f1c40f";
    }

    const t=document.querySelector("#previewTable tbody");
    t.innerHTML="";
    dadosCalculados.forEach((r,i)=>{
      const entradaDisp=r.entradaPorOperacao.map((v,j)=>`${j+1}ª: R$ ${formatar(v)}`).join(" → ");
      const lucroDisp=r.lucroPorOperacao.map((v,j)=>`${j+1}ª: R$ ${formatar(v)}`).join(" → ");
      let bgColor="";
      if(r.resultado==="Win") bgColor="style='background:#d4edda'";
      else if(r.resultado==="Loss 1ª") bgColor="style='background:#f8d7da'";
      else if(r.resultado==="Loss 2ª") bgColor="style='background:#fff3cd'";
      t.innerHTML+=`
        <tr ${bgColor}>
          <td>${r.dia}</td>
          <td>R$ ${formatar(r.bancaInicial)}</td>
          <td>${r.investimentoPercentual}%</td>
          <td>${entradaDisp}</td>
          <td>${lucroDisp}</td>
          <td><strong>R$ ${formatar(r.lucroTotalDia)}</strong></td>
          <td>R$ ${formatar(r.novaBanca)}</td>
          <td>${r.tipoGerenciamento}</td>
          <td>
            <button onclick="aplicarResultado(${i},'win')" style="background:#2ecc71;color:#fff;border:none;padding:4px 6px;border-radius:6px;">✅</button>
            <button onclick="aplicarResultado(${i},'loss1')" style="background:#e74c3c;color:#fff;border:none;padding:4px 6px;border-radius:6px;">❌1ª</button>
            <button onclick="aplicarResultado(${i},'loss2')" style="background:#f39c12;color:#fff;border:none;padding:4px 6px;border-radius:6px;">⚠️2ª</button>
          </td>
        </tr>`;
    });
    t.innerHTML+=`
      <tr style="background:#e3f2fd;font-weight:bold;">
        <td colspan="3">Totais</td><td colspan="2"></td>
        <td>Lucro Total:</td><td>R$ ${formatar(lucroTotal)}</td>
        <td>Crescimento:</td><td colspan="2">${crescimento.toFixed(2)}%</td>
      </tr>`;
  }

  ["bancaInicial","investimentoPercentual","payoutPercentual","operacoesPorDia","diasPlanejamento"]
  .forEach(id=>document.getElementById(id)?.addEventListener("input",calcularDados));
  document.querySelectorAll('input[name="tipoGerenciamento"]').forEach(r=>r.addEventListener("change",calcularDados));
  carregarDados();
  setTimeout(calcularDados,100);

  });
  </script>
</body>
</html>
